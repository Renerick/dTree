function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.dTree=t()}(this,function(){"use strict";var e=function(){function e(t,n){_classCallCheck(this,e),e.DEBUG_LEVEL=n.debug?1:0,this.root=t.root,this.siblings=t.siblings,this.parents=t.parents,this.opts=n,this.allNodes=this._flatten(this.root),this.allNodes=this.allNodes.concat(this._flatten(this.parents));var r=_.filter(this.allNodes,function(e){return!e.hidden});this.nodeSize=n.callbacks.nodeSize(r,n.nodeWidth,n.callbacks.textRenderer)}return _createClass(e,[{key:"create",value:function(){var e=this.opts,t=(this.allNodes,this.nodeSize),n=e.width+e.margin.left+e.margin.right,r=e.height+e.margin.top+e.margin.bottom,a=d3.zoom().scaleExtent([.1,10]).on("zoom",function(){i.attr("transform",d3.event.transform.translate(n/2,e.margin.top))}),i=this.svg=d3.select(e.target).append("svg").attr("width",n).attr("height",r).call(a).append("g").attr("transform","translate("+n/2+","+e.margin.top+")");this.tree=d3.tree().nodeSize([2*t[0],e.callbacks.nodeHeightSeperation(t[0],t[1])]),this.inverseTree=d3.tree().nodeSize([2*t[0],e.callbacks.nodeHeightSeperation(t[0],t[1])*-1]),this.tree.separation(function(e,t){return e.data.hidden||t.data.hidden?.3:.6}),this.inverseTree.separation(function(e,t){return e.data.hidden||t.data.hidden?.3:.6}),this._update()}},{key:"_update",value:function(){var e=this.opts,t=(this.allNodes,this.nodeSize),n=this.tree(this.root),r=this.inverseTree(this.parents);_.zip(n.children,r.children).forEach(function(e){e[1].children&&(e[0].children=e[0].children?e[0].children.concat(e[1].children):e[1].children,e[1].children&&e[1].children.forEach(function(t){t.parent=e[0]}))});var a=n.links();this.svg.selectAll(".link").data(a).enter().filter(function(e){return!e.target.data.noParent}).append("path").attr("class",e.styles.linage).attr("d",this._elbow);var i=this.svg.selectAll(".node").data(n.descendants()).enter();this._linkSiblings(),this.svg.selectAll(".sibling").data(this.siblings).enter().append("path").attr("class",e.styles.marriage).attr("d",_.bind(this._siblingLine,this)),i.append("foreignObject").filter(function(e){return!e.data.hidden}).attr("x",function(e){return e.x-e.cWidth/2+"px"}).attr("y",function(e){return e.y-e.cHeight/2+"px"}).attr("width",function(e){return e.cWidth+"px"}).attr("height",function(e){return e.cHeight+"px"}).attr("id",function(e){return e.id}).html(function(n){return e.callbacks.nodeRenderer(n.data.name,n.x,n.y,t[0],t[1],n.data.extra,n.data.id,n.data["class"],n.data.textClass,e.callbacks.textRenderer)}).on("click",function(t){t.data.hidden||e.callbacks.nodeClick(t.data.name,t.data.extra,t.data.id)}).on("contextmenu",function(t){t.data.hidden||(d3.event.preventDefault(),e.callbacks.nodeRightClick(t.data.name,t.data.extra,t.data.id))})}},{key:"_flatten",value:function(e){function t(e){e.children&&e.children.forEach(t),e.id||(e.id=++r),n.push(e)}var n=[],r=0;return t(e),n}},{key:"_elbow",value:function(e,t){if(e.target.data.noParent)return"M0,0L0,0";var n=e.target.y+.5*(e.source.y-e.target.y),r=[{x:e.target.x,y:e.target.y},{x:e.target.x,y:n},{x:e.source.x,y:e.source.y}],a=d3.line().curve(d3.curveStepAfter).x(function(e){return e.x}).y(function(e){return e.y});return a(r)}},{key:"_linkSiblings",value:function(){var e=this.allNodes;_.forEach(this.siblings,function(t){var n=e.filter(function(e){return t.source.id==e.data.id}),r=e.filter(function(e){return t.target.id==e.data.id});t.source.x=n[0].x,t.source.y=n[0].y,t.target.x=r[0].x,t.target.y=r[0].y;var a=null!=n[0].data.marriageNode?n[0].data.marriageNode.id:r[0].data.marriageNode.id,i=e.find(function(e){return e.data.id==a});t.source.marriageNode=i,t.target.marriageNode=i})}},{key:"_siblingLine",value:function(e,t){var n=e.target.y+.5*(e.source.y-e.target.y),r=this.nodeSize[0],a=this.nodeSize[1];e.number>0&&(n-=8*a/10);var i=[{x:e.source.x,y:e.source.y},{x:e.source.x+6*r/10,y:e.source.y},{x:e.source.x+6*r/10,y:n},{x:e.target.marriageNode.x,y:n},{x:e.target.marriageNode.x,y:e.target.y},{x:e.target.x,y:e.target.y}],d=d3.line().curve(d3.curveStepAfter).x(function(e){return e.x}).y(function(e){return e.y});return d(i)}}],[{key:"_nodeHeightSeperation",value:function(e,t){return t+25}},{key:"_nodeSize",value:function(e,t,n){var r=0,a=document.createElement("svg");return document.body.appendChild(a),_.map(e,function(e){var i=document.createElement("div");i.setAttribute("class",e.data["class"]),i.style.visibility="hidden",i.style.maxWidth=t+"px";var d=n(e.data.name,e.data.extra,e.data.textClass);i.innerHTML=d,a.appendChild(i);var o=i.offsetHeight;a.removeChild(i),r=Math.max(r,o),e.cHeight=o,e.data.hidden?e.cWidth=0:e.cWidth=t}),document.body.removeChild(a),[t,r]}},{key:"_nodeRenderer",value:function(e,t,n,r,a,i,d,o,s,c){var l="";return l+="<div ",l+='style="height:100%;width:100%;" ',l+='class="'+o+'" ',l+='id="node'+d+'">\n',l+=c(e,i,s),l+="</div>"}},{key:"_textRenderer",value:function(e,t,n){var r="";return r+="<p ",r+='align="center" ',r+='class="'+n+'">\n',r+=e,r+="</p>\n"}},{key:"_debug",value:function(t){e.DEBUG_LEVEL>0&&console.log(t)}}]),e}(),t={VERSION:"2.2.1",init:function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=_.defaultsDeep(n||{},{target:"#graph",debug:!1,width:600,height:600,callbacks:{nodeClick:function(e,t,n){},nodeRightClick:function(e,t,n){},nodeHeightSeperation:function(t,n){return e._nodeHeightSeperation(t,n)},nodeRenderer:function(t,n,r,a,i,d,o,s,c,l){return e._nodeRenderer(t,n,r,a,i,d,o,s,c,l)},nodeSize:function(t,n,r){return e._nodeSize(t,n,r)},nodeSorter:function(e,t,n,r){return 0},textRenderer:function(t,n,r){return e._textRenderer(t,n,r)}},margin:{top:0,right:0,bottom:0,left:0},nodeWidth:100,styles:{node:"node",linage:"linage",marriage:"marriage",text:"nodeText"}}),t=this._preprocess(t,r),a=new e(t,r);a.create()},_preprocess:function(e,n){var r=[],a=0,i={name:"",id:a++,hidden:!0,children:[]},d=function o(e,d){var s={name:e.name,id:a++,hidden:!1,children:[],parents:[],extra:e.extra,isParent:!!e.isParent,textClass:e.textClass?e.textClass:n.styles.text,"class":e["class"]?e["class"]:n.styles.node};d==i&&(s.noParent=!0);for(var c=0;c<e.depthOffset;c++){var l={name:"",id:a++,hidden:!0,children:[],noParent:s.noParent,isParent:s.isParent};d.children.push(l),d=l}if(t._sortPersons(e.children,n),_.forEach(e.children,function(e){o(e,s)}),e.parents){var u=e.parents[0];u&&(u.isParent=!0);var h=e.parents[1];h&&(h.isParent=!0);var f={name:"",id:a++,hidden:!0,noParent:!1,isParent:!0,children:[],parents:[],extra:null};if(u)var g=o(u,s);if(u&&h&&s.parents.push(f),h){var p=o(h,s);p.marriageNode=f}u&&h&&(g.noParent=!0,p.noParent=!0,r.push({source:{id:g.id},target:{id:p.id},number:0}))}return s.isParent?d.parents.push(s):d.children.push(s),t._sortMarriages(e.marriages,n),_.forEach(e.marriages,function(e,i){var c={name:"",id:a++,hidden:!0,noParent:!0,children:[],extra:e.extra};d.children.push(c);var l=e.spouse,u=o(l,d);u.marriageNode=c,u.noParent=!0,t._sortPersons(e.children,n),_.forEach(e.children,function(e){o(e,c)}),r.push({source:{id:s.id},target:{id:u.id},number:i})}),d==i&&(d.parents=_.clone(d.children)),s};return _.forEach(e,function(e){d(e,i)}),{root:d3.hierarchy(i,function(e){return e.children}),parents:d3.hierarchy(i,function(e){return e.parents}),siblings:r}},_sortPersons:function(e,t){return void 0!=e&&e.sort(function(e,n){return t.callbacks.nodeSorter(e.name,e.extra,n.name,n.extra)}),e},_sortMarriages:function(e,t){return void 0!=e&&Array.isArray(e)&&e.sort(function(e,n){var r=e.spouse,a=n.spouse;return t.callbacks.nodeSorter(r.name,r.extra,a.name,a.extra)}),e}};return t});
//# sourceMappingURL=dTree.min.js.map
